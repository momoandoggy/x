<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Aplikasi Google Play Store 24/7</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS sama seperti sebelumnya, tetap dipertahankan */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        /* ... (CSS lengkap sama seperti sebelumnya) ... */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fab fa-google-play"></i> Monitor Aplikasi Play Store 24/7</h1>
            <p>‚úÖ MONITORING AKTIF 24/7 - Berjalan meski browser ditutup!</p>
        </header>

        <div class="dashboard">
            <div class="stats">
                <div class="stat-card">
                    <h3>Total Aplikasi</h3>
                    <span id="total-apps">0</span>
                </div>
                <div class="stat-card">
                    <h3>Aktif</h3>
                    <span id="active-apps">0</span>
                </div>
                <div class="stat-card">
                    <h3>Dihapus</h3>
                    <span id="removed-apps">0</span>
                </div>
                <div class="stat-card">
                    <h3>Notifikasi Terkirim</h3>
                    <span id="notifications-sent">0</span>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Card untuk menambah aplikasi -->
            <div class="card">
                <h2><i class="fas fa-plus-circle"></i> Tambah Aplikasi</h2>
                <div class="form-group">
                    <label for="app-id">ID Aplikasi (Package Name):</label>
                    <input type="text" id="app-id" placeholder="Contoh: com.example.app">
                </div>
                <div class="form-group">
                    <label for="app-url">URL Aplikasi Play Store:</label>
                    <input type="url" id="app-url" placeholder="https://play.google.com/store/apps/details?id=...">
                </div>
                <button id="add-app-btn" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Tambah Aplikasi
                </button>
            </div>

            <!-- Daftar aplikasi yang dimonitor -->
            <div class="card">
                <h2><i class="fas fa-list"></i> Daftar Aplikasi yang Dimonitor 24/7</h2>
                <div class="table-container">
                    <table id="apps-table">
                        <thead>
                            <tr>
                                <th>ID Aplikasi</th>
                                <th>URL</th>
                                <th>Status</th>
                                <th>Terakhir Diperiksa</th>
                                <th>Notifikasi</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="apps-list">
                            <!-- Daftar aplikasi akan dimuat di sini -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Konfigurasi Bot Telegram -->
            <div class="card">
                <h2><i class="fab fa-telegram"></i> Konfigurasi Bot Telegram</h2>
                <div class="form-group">
                    <label for="bot-token">Token Bot Telegram:</label>
                    <input type="text" id="bot-token" placeholder="Masukkan token bot Anda">
                </div>
                <div class="form-group">
                    <label for="chat-id">ID Grup/Channel Telegram:</label>
                    <input type="text" id="chat-id" placeholder="Contoh: -1001234567890">
                </div>
                <button id="save-bot-config" class="btn btn-primary">
                    <i class="fas fa-save"></i> Simpan Konfigurasi Bot
                </button>
                <button id="test-bot" class="btn btn-warning">
                    <i class="fas fa-paper-plane"></i> Test Bot
                </button>
            </div>

            <!-- Informasi Sistem 24/7 -->
            <div class="card">
                <h2><i class="fas fa-server"></i> Status Server Monitoring 24/7</h2>
                <div class="system-info">
                    <p><strong>Status Server:</strong> <span id="server-status" class="status-active">üü¢ AKTIF 24/7</span></p>
                    <p><strong>URL Backend:</strong> <span id="backend-url">https://your-app.herokuapp.com</span></p>
                    <p><strong>Database:</strong> <span id="database-status">MongoDB Atlas</span></p>
                    <p><strong>Interval Pengecekan:</strong> <span id="check-interval">60</span> detik</p>
                    <p><strong>Pengecekan Terakhir:</strong> <span id="last-check">-</span></p>
                    <p><strong>Notifikasi Dikirim:</strong> <span id="notifications-count">0</span></p>
                </div>
                <button id="refresh-status" class="btn btn-success">
                    <i class="fas fa-sync-alt"></i> Refresh Status
                </button>
            </div>

            <!-- Log Aktivitas -->
            <div class="card">
                <h2><i class="fas fa-history"></i> Log Aktivitas Server</h2>
                <div class="log-container" id="activity-log">
                    <div class="log-entry"><span class="log-time">[Sistem]</span> <span class="log-info">Memuat data dari server...</span></div>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2023 Monitor Aplikasi Play Store 24/7. Server aktif meski browser ditutup!</p>
        </footer>
    </div>

    <script>
        class PlayStoreMonitor24_7 {
            constructor() {
                this.backendUrl = 'https://your-playstore-monitor.herokuapp.com'; // Ganti dengan URL backend Anda
                this.apps = [];
                this.botConfig = {};
                
                this.initializeApp();
            }
            
            async initializeApp() {
                await this.loadDataFromServer();
                this.setupEventListeners();
                this.updateUI();
                this.startAutoRefresh();
                this.addToLog('Dashboard terhubung dengan server monitoring 24/7', 'success');
            }
            
            setupEventListeners() {
                document.getElementById('add-app-btn').addEventListener('click', () => {
                    this.addApp();
                });
                
                document.getElementById('save-bot-config').addEventListener('click', () => {
                    this.saveBotConfig();
                });
                
                document.getElementById('test-bot').addEventListener('click', () => {
                    this.testBot();
                });
                
                document.getElementById('refresh-status').addEventListener('click', () => {
                    this.refreshAllData();
                });
            }
            
            async loadDataFromServer() {
                try {
                    const [appsRes, configRes, statsRes] = await Promise.all([
                        fetch(`${this.backendUrl}/api/apps`),
                        fetch(`${this.backendUrl}/api/config`),
                        fetch(`${this.backendUrl}/api/stats`)
                    ]);
                    
                    if (appsRes.ok) this.apps = await appsRes.json();
                    if (configRes.ok) this.botConfig = await configRes.json();
                    if (statsRes.ok) {
                        const stats = await statsRes.json();
                        this.updateStats(stats);
                    }
                    
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.addToLog('Gagal memuat data dari server', 'error');
                }
            }
            
            async addApp() {
                const appId = document.getElementById('app-id').value.trim();
                const appUrl = document.getElementById('app-url').value.trim();
                
                if (!appId || !appUrl) {
                    this.showMessage('Error', 'ID Aplikasi dan URL harus diisi!', 'error');
                    return;
                }
                
                try {
                    const response = await fetch(`${this.backendUrl}/api/apps`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            appId: appId,
                            appUrl: appUrl
                        })
                    });
                    
                    if (response.ok) {
                        this.addToLog(`Aplikasi "${appId}" ditambahkan ke monitoring 24/7`, 'success');
                        this.showMessage('Sukses', 'Aplikasi berhasil ditambahkan! Monitoring aktif 24/7.', 'success');
                        
                        // Reset form
                        document.getElementById('app-id').value = '';
                        document.getElementById('app-url').value = '';
                        
                        // Reload data
                        await this.loadDataFromServer();
                        this.updateUI();
                    } else {
                        throw new Error('Gagal menambahkan aplikasi');
                    }
                } catch (error) {
                    this.addToLog('Gagal menambahkan aplikasi: ' + error.message, 'error');
                    this.showMessage('Error', 'Gagal menambahkan aplikasi', 'error');
                }
            }
            
            async deleteApp(appId) {
                try {
                    const response = await fetch(`${this.backendUrl}/api/apps/${appId}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        this.addToLog(`Aplikasi "${appId}" dihapus dari monitoring`, 'info');
                        await this.loadDataFromServer();
                        this.updateUI();
                    }
                } catch (error) {
                    this.addToLog('Gagal menghapus aplikasi', 'error');
                }
            }
            
            async saveBotConfig() {
                const token = document.getElementById('bot-token').value.trim();
                const chatId = document.getElementById('chat-id').value.trim();
                
                if (!token || !chatId) {
                    this.showMessage('Error', 'Token dan Chat ID harus diisi!', 'error');
                    return;
                }
                
                try {
                    const response = await fetch(`${this.backendUrl}/api/config`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            telegramBotToken: token,
                            telegramChatId: chatId
                        })
                    });
                    
                    if (response.ok) {
                        this.addToLog('Konfigurasi bot berhasil disimpan', 'success');
                        this.showMessage('Sukses', 'Konfigurasi bot berhasil disimpan!', 'success');
                    }
                } catch (error) {
                    this.addToLog('Gagal menyimpan konfigurasi bot', 'error');
                    this.showMessage('Error', 'Gagal menyimpan konfigurasi bot', 'error');
                }
            }
            
            async testBot() {
                try {
                    const response = await fetch(`${this.backendUrl}/api/test-bot`, {
                        method: 'POST'
                    });
                    
                    if (response.ok) {
                        this.addToLog('Pesan test berhasil dikirim ke Telegram', 'success');
                        this.showMessage('Sukses', 'Pesan test berhasil dikirim!', 'success');
                    }
                } catch (error) {
                    this.addToLog('Gagal mengirim pesan test', 'error');
                    this.showMessage('Error', 'Gagal mengirim pesan test', 'error');
                }
            }
            
            updateUI() {
                this.updateAppsTable();
                this.updateBotConfigUI();
            }
            
            updateAppsTable() {
                const tbody = document.getElementById('apps-list');
                tbody.innerHTML = '';
                
                if (this.apps.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">Tidak ada aplikasi yang dimonitor. Tambahkan aplikasi untuk memulai monitoring 24/7.</td></tr>';
                    return;
                }
                
                this.apps.forEach((app) => {
                    const row = document.createElement('tr');
                    let statusText = '';
                    let statusClass = '';
                    
                    switch (app.status) {
                        case 'active':
                            statusText = 'Aktif';
                            statusClass = 'status-active';
                            break;
                        case 'removed':
                            statusText = 'Dihapus';
                            statusClass = 'status-removed';
                            break;
                        case 'notified':
                            statusText = 'Sudah Diberitahu';
                            statusClass = 'status-notified';
                            break;
                        default:
                            statusText = 'Aktif';
                            statusClass = 'status-active';
                    }
                    
                    row.innerHTML = `
                        <td>${this.escapeHtml(app.appId)}</td>
                        <td><a href="${this.escapeHtml(app.appUrl)}" target="_blank">${this.escapeHtml(app.appUrl)}</a></td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td>${app.lastChecked ? new Date(app.lastChecked).toLocaleString('id-ID') : '-'}</td>
                        <td>${app.notificationSent ? '‚úÖ ' + new Date(app.notificationSent).toLocaleString('id-ID') : '‚ùå Belum'}</td>
                        <td>
                            <button class="btn btn-danger btn-sm delete-app" data-id="${app.appId}"><i class="fas fa-trash"></i> Hapus</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Tambah event listeners untuk tombol hapus
                document.querySelectorAll('.delete-app').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const appId = e.target.closest('button').getAttribute('data-id');
                        this.deleteApp(appId);
                    });
                });
            }
            
            updateBotConfigUI() {
                if (this.botConfig.telegramBotToken) {
                    document.getElementById('bot-token').value = this.botConfig.telegramBotToken;
                }
                if (this.botConfig.telegramChatId) {
                    document.getElementById('chat-id').value = this.botConfig.telegramChatId;
                }
            }
            
            updateStats(stats) {
                document.getElementById('total-apps').textContent = stats.totalApps || 0;
                document.getElementById('active-apps').textContent = stats.activeApps || 0;
                document.getElementById('removed-apps').textContent = stats.removedApps || 0;
                document.getElementById('notifications-sent').textContent = stats.notificationsSent || 0;
                document.getElementById('notifications-count').textContent = stats.notificationsSent || 0;
                document.getElementById('last-check').textContent = stats.lastCheck ? new Date(stats.lastCheck).toLocaleString('id-ID') : '-';
            }
            
            async refreshAllData() {
                await this.loadDataFromServer();
                this.updateUI();
                this.addToLog('Data diperbarui dari server', 'info');
            }
            
            startAutoRefresh() {
                // Refresh data setiap 30 detik
                setInterval(() => {
                    this.refreshAllData();
                }, 30000);
            }
            
            addToLog(message, type = 'info') {
                const logContainer = document.getElementById('activity-log');
                const timestamp = new Date().toLocaleTimeString('id-ID');
                
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `
                    <span class="log-time">[${timestamp}]</span>
                    <span class="log-${type}">${this.escapeHtml(message)}</span>
                `;
                
                logContainer.appendChild(logEntry);
                logContainer.scrollTop = logContainer.scrollHeight;
                
                // Batasi log hingga 50 entri
                if (logContainer.children.length > 50) {
                    logContainer.removeChild(logContainer.firstChild);
                }
            }
            
            showMessage(title, text, type = 'info') {
                alert(`${title}: ${text}`); // Bisa diganti dengan modal yang lebih baik
            }
            
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        }

        // Inisialisasi aplikasi
        document.addEventListener('DOMContentLoaded', () => {
            window.monitor = new PlayStoreMonitor24_7();
        });
    </script>
</body>
</html>
